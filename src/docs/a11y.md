# Accessibility Guidelines (Mosaic)

Mosaic is an emotion-first app. Accessibility is not “polish” — it’s part of the product.
This doc defines the baseline rules we follow while building.

## Core principles

1. **Never rely on color alone**
   - Every color-coded UI must also communicate meaning via **text, icon, shape, or pattern**.
   - Emotion tiles must show the emotion label (and optionally an icon) in addition to color.

2. **Respect user settings**
   - Dynamic Type (font scaling)
   - Reduce Motion
   - Screen readers (VoiceOver/TalkBack)
   - High contrast preferences (where available)

3. **Default to predictable semantics**
   - Correct roles, labels, states, and focus order.

---

## Emotion Color Themes (separate from App Theme)

Mosaic uses emotion colors as a primary interface. Because users can have different types of color vision deficiency, emotion colors must be **themeable** independently of the app’s light/dark UI theme.

### Requirements

- The app must support multiple **Emotion Palettes** (emotion color themes), e.g.:
  - `default`
  - `highContrast`
  - `deuteranopiaFriendly`
  - `protanopiaFriendly`
  - `tritanopiaFriendly`
  - `monochrome` (pattern/shape driven)
- Emotion palette selection must:
  - be persisted locally
  - take effect instantly
  - be usable without color (labels remain visible)
- Each emotion must be identifiable without color:
  - show label text
  - optionally show a unique icon per emotion or per group
  - optionally use outlines/borders/patterns to reinforce differences

### Implementation guidance

- Store entries by **emotionId**, not by color.
- Colors are derived from:
  - `emotionId` + selected `emotionPaletteId`
- If a palette changes, historical data remains correct because the semantic emotion id doesn’t change.

### Visual requirements for emotion tiles/cards

- Emotion tiles must include:
  - Label text (required)
  - Selected state must have more than a color change (e.g., checkmark + outline)
- Ensure minimum contrast for any text rendered on color backgrounds.
  - If uncertain: render label on a neutral surface (e.g., chip/overlay) instead of directly on the color.
- Support “color off” / monochrome palette mode:
  - Use outlines + icons + text as the primary encoding.

---

## Touch targets and interaction

- Minimum hit target: **44×44pt**.
- Pressable elements must have:
  - `accessibilityRole` (button, tab, switch, etc.)
  - An accessible label
- Icon-only controls require `accessibilityLabel`.
  - Example: a trash icon must be labeled `"Delete entry"`.

### Disabled/selected state

- When disabled, set:
  - `accessibilityState={{ disabled: true }}`
- When selected/toggled, set:
  - `accessibilityState={{ selected: true }}` or `{ checked: true }` depending on control type.

---

## Screen reader support

### Labels and hints

- Prefer concise labels that match visible text.
- Use `accessibilityHint` for actions that aren’t obvious.
  - Example: `"Opens mood details"`.

### Grouping

- Use `accessibilityRole="header"` for screen titles where helpful.
- Ensure lists announce themselves as lists.
- Avoid wrapping many interactive children inside a parent marked `accessible` unless you intend the parent to be the single focus target.

### Focus order

- Ensure focus order matches visual order (top-to-bottom, left-to-right).
- After navigation:
  - Ensure the first meaningful control is reachable without multiple swipes.

---

## Typography and Dynamic Type

- All text must respect Dynamic Type scaling.
- Avoid fixed heights that clip large text.
- Use `maxFontSizeMultiplier` only when truly necessary (and document why).

---

## Reduce Motion

- Respect OS “Reduce Motion”.
- Avoid essential meaning conveyed only via animation.
- Provide reduced motion variants for:
  - looping animations
  - large parallax / spring transitions

---

## Color and contrast

### General rules

- Do not convey meaning only via color.
- For text on backgrounds:
  - ensure strong contrast
  - if contrast is unknown, use a neutral label chip (e.g., light/dark surface) on top of the color.

### Dev-time checks

- Add a dev helper that warns when contrast is too low (optional but recommended).
- Test emotion palettes in grayscale (manual check) to ensure non-color encoding still works.

---

## Forms and inputs

- Inputs must have:
  - a visible label (preferred) or an accessible label
  - helpful error messages
- Errors must be announced:
  - show error text
  - set `accessibilityLiveRegion="polite"` for dynamic error messages where appropriate

---

## Testing expectations

### Manual testing (minimum)

Before shipping a feature:
- VoiceOver (iOS): can you complete the flow with screen reader?
- TalkBack (Android): can you complete the flow with screen reader?
- Large text: does layout break?
- Reduce Motion: does UI remain usable?
- Emotion palette switching: does meaning remain clear?

### Automated tests (recommended)

- Unit tests for primitives:
  - IconButton requires `accessibilityLabel`
  - Selected states set `accessibilityState`
- Snapshot tests only for stable primitives (avoid huge screens).

---

## Build checklist (PR-ready)

- [ ] No feature relies on color alone
- [ ] All pressables have role + label
- [ ] Icon-only buttons have `accessibilityLabel`
- [ ] Selected/disabled states include `accessibilityState`
- [ ] Works with large text (no clipping)
- [ ] Reduce Motion supported for significant animations
- [ ] Emotion palette switching does not break meaning
- [ ] Manual screen reader spot-check completed for new flow
